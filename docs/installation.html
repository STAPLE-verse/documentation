<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Installation Guide – STAPLE Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./summary.html" rel="next">
<link href="./walkthrough.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="glossary/glossary.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./installation.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Installation Guide</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAPLE Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Documentation: Metadata</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./staple-elements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Overview of STAPLE</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./walkthrough.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Example Walkthroughs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./installation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Installation Guide</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./terminology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Terminology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link active" data-scroll-target="#assumptions"><span class="header-section-number">6.1</span> Assumptions</a></li>
  <li><a href="#installation-on-a-server" id="toc-installation-on-a-server" class="nav-link" data-scroll-target="#installation-on-a-server"><span class="header-section-number">6.2</span> Installation on a Server</a>
  <ul class="collapse">
  <li><a href="#web-server-installation" id="toc-web-server-installation" class="nav-link" data-scroll-target="#web-server-installation"><span class="header-section-number">6.2.1</span> Web Server Installation</a></li>
  <li><a href="#blitzjs-installation" id="toc-blitzjs-installation" class="nav-link" data-scroll-target="#blitzjs-installation"><span class="header-section-number">6.2.2</span> Blitz/JS Installation</a></li>
  <li><a href="#clone-this-repository" id="toc-clone-this-repository" class="nav-link" data-scroll-target="#clone-this-repository"><span class="header-section-number">6.2.3</span> Clone This Repository</a></li>
  <li><a href="#database-installation" id="toc-database-installation" class="nav-link" data-scroll-target="#database-installation"><span class="header-section-number">6.2.4</span> Database Installation</a></li>
  <li><a href="#connect-database-to-staple-app" id="toc-connect-database-to-staple-app" class="nav-link" data-scroll-target="#connect-database-to-staple-app"><span class="header-section-number">6.2.5</span> Connect Database to STAPLE App</a></li>
  <li><a href="#install-staple-requirements" id="toc-install-staple-requirements" class="nav-link" data-scroll-target="#install-staple-requirements"><span class="header-section-number">6.2.6</span> Install STAPLE Requirements</a></li>
  <li><a href="#starting-the-app---local-testing" id="toc-starting-the-app---local-testing" class="nav-link" data-scroll-target="#starting-the-app---local-testing"><span class="header-section-number">6.2.7</span> Starting the App - Local Testing</a></li>
  <li><a href="#starting-the-app---production" id="toc-starting-the-app---production" class="nav-link" data-scroll-target="#starting-the-app---production"><span class="header-section-number">6.2.8</span> Starting the App - Production</a></li>
  <li><a href="#keeping-the-app-going" id="toc-keeping-the-app-going" class="nav-link" data-scroll-target="#keeping-the-app-going"><span class="header-section-number">6.2.9</span> Keeping the App Going</a></li>
  <li><a href="#setting-up-the-proxy" id="toc-setting-up-the-proxy" class="nav-link" data-scroll-target="#setting-up-the-proxy"><span class="header-section-number">6.2.10</span> Setting Up the Proxy</a></li>
  </ul></li>
  <li><a href="#common-errors" id="toc-common-errors" class="nav-link" data-scroll-target="#common-errors"><span class="header-section-number">6.3</span> Common Errors</a></li>
  <li><a href="#run-on-your-own-computer" id="toc-run-on-your-own-computer" class="nav-link" data-scroll-target="#run-on-your-own-computer"><span class="header-section-number">6.4</span> Run on Your Own Computer</a>
  <ul class="collapse">
  <li><a href="#blitzjs-installation-1" id="toc-blitzjs-installation-1" class="nav-link" data-scroll-target="#blitzjs-installation-1"><span class="header-section-number">6.4.1</span> Blitz/JS Installation</a></li>
  <li><a href="#clone-this-repository-1" id="toc-clone-this-repository-1" class="nav-link" data-scroll-target="#clone-this-repository-1"><span class="header-section-number">6.4.2</span> Clone This Repository</a></li>
  <li><a href="#database-installation-1" id="toc-database-installation-1" class="nav-link" data-scroll-target="#database-installation-1"><span class="header-section-number">6.4.3</span> Database Installation</a></li>
  <li><a href="#connect-database-to-staple-app-1" id="toc-connect-database-to-staple-app-1" class="nav-link" data-scroll-target="#connect-database-to-staple-app-1"><span class="header-section-number">6.4.4</span> Connect Database to STAPLE App</a></li>
  <li><a href="#install-staple-requirements-1" id="toc-install-staple-requirements-1" class="nav-link" data-scroll-target="#install-staple-requirements-1"><span class="header-section-number">6.4.5</span> Install STAPLE Requirements</a></li>
  <li><a href="#starting-the-app---local-testing-1" id="toc-starting-the-app---local-testing-1" class="nav-link" data-scroll-target="#starting-the-app---local-testing-1"><span class="header-section-number">6.4.6</span> Starting the App - Local Testing</a></li>
  <li><a href="#starting-the-app---production-1" id="toc-starting-the-app---production-1" class="nav-link" data-scroll-target="#starting-the-app---production-1"><span class="header-section-number">6.4.7</span> Starting the App - Production</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Installation Guide</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>SEPARATE: - DEVELOPMENT/CODING - RUN LOCAL MACHINE - PRODUCTION / SERVER VERSION</p>
<section id="assumptions" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="assumptions"><span class="header-section-number">6.1</span> Assumptions</h2>
<ul>
<li><p>This guide assumes the following:</p>
<ul>
<li>You are working on a Linux server. We are specifically using Ubuntu 20, but this guide should be consistent for most versions of Linux.</li>
<li>You have access to the shell command console. You will need access to install files directly onto the server computer.</li>
<li>You have worked with the command line before.</li>
<li>You have <code>sudo</code> rights to add files and services.</li>
<li>You know what a hidden file is and at least how to google how to view them.</li>
<li>You know what SQL and databases are, even if you’ve never worked with PostgreSQL before.</li>
<li>You know what Apache and/or nginx servers are and how to edit their files.</li>
<li>You can at least imagine yourself using git.</li>
</ul></li>
</ul>
</section>
<section id="installation-on-a-server" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="installation-on-a-server"><span class="header-section-number">6.2</span> Installation on a Server</h2>
<section id="web-server-installation" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="web-server-installation"><span class="header-section-number">6.2.1</span> Web Server Installation</h3>
<ul>
<li>Apache - <a href="https://ubuntu.com/tutorials/install-and-configure-apache">Installation Instructions</a></li>
<li>Nginx - <a href="https://ubuntu.com/tutorials/install-and-configure-nginx">Installation Instructions</a></li>
<li>They really aren’t big fans of each other, only install one. We are using nginx on our server.</li>
</ul>
</section>
<section id="blitzjs-installation" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="blitzjs-installation"><span class="header-section-number">6.2.2</span> Blitz/JS Installation</h3>
<ul>
<li>Install <code>node.js</code> and <code>npm</code> - <a href="https://www.linode.com/docs/guides/install-nodejs-on-ubuntu-22-04/">Installation Instructions</a>
<ul>
<li><a href="https://nodejs.org/en/download">Other downloads</a></li>
<li>You should have at least node v18+ and npm v9+.</li>
<li>You can check your versions by using <code>node -v</code> and <code>npm -v</code> in a terminal or command window.</li>
<li>You may also use yarn, but this guide uses npm.</li>
</ul></li>
<li>Install <code>blitzjs</code>: <code>npm install -g blitz</code> in a terminal/command window. Check your version is at least v2+ by using <code>blitz -v</code> in a command window.</li>
</ul>
<p>ERIN UPDATE THIS BECAUSE BLAH</p>
<ul>
<li>Depending on server setup, you may need <code>sudo</code> privileges.</li>
</ul>
</section>
<section id="clone-this-repository" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="clone-this-repository"><span class="header-section-number">6.2.3</span> Clone This Repository</h3>
<ul>
<li>Clone or copy this github repository to the server.
<ul>
<li>Install git on the machine using: <code>sudo apt-get update</code> <code>sudo apt-get install git</code></li>
<li>Navigate to <code>/var/www/html/</code> or <code>/var/www/</code> on the Linux machine.</li>
<li>Clone the repository by using this guide - <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository">Installation Instructions</a>. <code>git clone https://github.com/STAPLE-verse/STAPLE.git</code></li>
<li>This will make a folder called STAPLE with all the files you need.</li>
</ul></li>
<li>Navigate to that folder by using <code>cd STAPLE</code>.</li>
</ul>
</section>
<section id="database-installation" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="database-installation"><span class="header-section-number">6.2.4</span> Database Installation</h3>
<ul>
<li>Ensure that you have a local postgres service running on your computer.</li>
<li>To install see: <a href="https://www.prisma.io/dataguide/postgresql/setting-up-a-local-postgresql-database">Installation Instructions</a>.
<ul>
<li>Be sure to write down the superuser information as you are installing the setup for non-Linux machines.</li>
<li>You may use other databases, but will need to modify the provided code for their implementation.</li>
</ul></li>
<li>Create the databases for STAPLE. Go to terminal and use:
<ul>
<li>Note that all lines that start with # are comments for explanation.</li>
</ul></li>
</ul>
<pre><code># get into postgres on linux
sudo -u postgres psql 
# enter your password for superuser when prompted
CREATE DATABASE staple;
CREATE DATABASE staple_test;</code></pre>
<p>CHANGE THE USER TO A DIFFERENT NAME BECAUSE STAPLE CONFUSING</p>
<ul>
<li>Create a user with appropriate privileges after postgres installation. While in the terminal and postgres, create a new user:</li>
<li>Change out <code>username</code> and <code>password</code> (be sure to leave the quotes!) for your desired user.</li>
</ul>
<pre><code>CREATE USER username WITH PASSWORD 'password';</code></pre>
<ul>
<li>Get into the STAPLE database. You can use <code>\l</code> and should see something like this:</li>
</ul>
<pre><code>postgres=# \l
                                     List of databases
    Name     |  Owner   | Encoding |   Collate   |    Ctype    |     Access privileges     
-------------+----------+----------+-------------+-------------+---------------------------
 postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 staple      | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =Tc/postgres             +
             |          |          |             |             | postgres=CTc/postgres    +
             |          |          |             |             | staple=CTc/postgres      +
             |          |          |             |             | staple_admin=CTc/postgres
 staple_test | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 template0   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres              +
             |          |          |             |             | postgres=CTc/postgres
 template1   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres              +
             |          |          |             |             | postgres=CTc/postgres
(5 rows)</code></pre>
<ul>
<li>Use the following to get into the STAPLE database.</li>
</ul>
<pre><code>postgres=# \c staple
You are now connected to database "staple" as user "postgres".
staple=# </code></pre>
<ul>
<li>You can check that schema exist using <code>\dn</code>:</li>
</ul>
<pre><code>staple=# \dn
 List of schemas
  Name  | Owner  
--------+--------
 public | staple
(1 row)

staple=# </code></pre>
<ul>
<li>Give your user the appropriate permissions to write to the database. Change out <code>username</code> for the user you created a minute ago.</li>
</ul>
<pre><code>GRANT ALL ON SCHEMA public TO username;</code></pre>
<ul>
<li>Use <code>quit;</code> to exit out of postgres.</li>
</ul>
<p>ALTER ROLE your_username CREATEDB; be sure to add this</p>
</section>
<section id="connect-database-to-staple-app" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="connect-database-to-staple-app"><span class="header-section-number">6.2.5</span> Connect Database to STAPLE App</h3>
<ul>
<li>Make sure you are in the folder that you copied the github repository into.</li>
<li>You can use <code>ls -al</code> to view all files in that folder.</li>
</ul>
<pre><code># for example on my server 
erin@staple:~$ cd /var/www/html/STAPLE
erin@staple:/var/www/html/STAPLE$ ls -al
total 764
drwxr-xr-x  13 root root   4096 Oct 24 06:17 .
drwxr-xr-x   6 root root   4096 Oct 24 05:02 ..
drwxr-xr-x   3 root root   4096 Oct 24 04:27 db
-rw-r--r--   1 root root    175 Oct 24 04:27 .editorconfig
-rw-r--r--   1 root root    494 Oct 24 06:17 .env
# more truncated # </code></pre>
<ul>
<li>Copy the <code>.env</code> file and rename it <code>.env.local</code>.
<ul>
<li>You may need to turn on settings to see these hidden files on your machine.</li>
<li>You can create and edit this file at once with <code>nano .env.local</code> or <code>vim</code> if you want.</li>
</ul></li>
<li>Ensure the <code>.env.local</code> file has required environment variables.
<ul>
<li>After the commented lines, add the <code>DATABASE_URL</code> line and change &lt;YOUR_DB_USERNAME&gt; to <code>username:password</code> (no &lt;&gt; these are here to show you what to change).</li>
</ul></li>
</ul>
<p>DID NOT RENDER CORRECTLY</p>
<pre><code>-   Create and add a `SESSION_SECRET_KEY`.
    -   In the command line prompt, use `openssl rand -hex 16` and copy this long letter/number combination instead of &lt;SESSIONKEY&gt;.</code></pre>
<pre><code># This env file should be checked into source control
# This is the place for default values for all environments
# Values in `.env.local` and `.env.production` will override these values
DATABASE_URL=postgresql://&lt;YOUR_DB_USERNAME&gt;@localhost:5432/staple
SESSION_SECRET_KEY=&lt;SESSIONKEY&gt;</code></pre>
<ul>
<li>Copy the <code>.env.test</code> file and rename <code>.env.test.local</code>.</li>
<li>Ensure the <code>.env.test.local</code> file has required environment variables in the same way you did above.</li>
</ul>
<pre><code>DATABASE_URL=postgresql://&lt;YOUR_DB_USERNAME&gt;@localhost:5432/staple_test</code></pre>
</section>
<section id="install-staple-requirements" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6" class="anchored" data-anchor-id="install-staple-requirements"><span class="header-section-number">6.2.6</span> Install STAPLE Requirements</h3>
<ul>
<li>Make sure you are in the STAPLE main folder. Use the following (not the <code>#</code> line, these are notes) to install packages, tailwind, and daisyui.</li>
</ul>
<pre><code># to install all packages for staple
npm install
# install tailwind css
blitz install tailwind
# install daisyui
npm i -D daisyui@latest</code></pre>
<ul>
<li>Next, use the following line to create the database structure/schema for STAPLE to run.</li>
</ul>
<pre><code># to create database with the right set up
blitz prisma generate
blitz prisma migrate dev</code></pre>
</section>
<section id="starting-the-app---local-testing" class="level3" data-number="6.2.7">
<h3 data-number="6.2.7" class="anchored" data-anchor-id="starting-the-app---local-testing"><span class="header-section-number">6.2.7</span> Starting the App - Local Testing</h3>
<ul>
<li>In a terminal window, go to the folder you cloned this repository and type:</li>
</ul>
<pre><code>blitz dev</code></pre>
<ul>
<li>Open (usually) <a href="http://localhost:3000" class="uri">http://localhost:3000</a> (or whatever it says for localhost in the terminal) with your browser to see the result.</li>
<li>This step works great on a “regular” computer, but may not be useful for a server. Instead run the service “in production” to view on your website.</li>
</ul>
</section>
<section id="starting-the-app---production" class="level3" data-number="6.2.8">
<h3 data-number="6.2.8" class="anchored" data-anchor-id="starting-the-app---production"><span class="header-section-number">6.2.8</span> Starting the App - Production</h3>
<ul>
<li>In a terminal window, go to the folder you cloned this repository and type:</li>
</ul>
<pre><code>blitz build</code></pre>
<ul>
<li>This step may produce errors in the build. You will need to fix these errors before running the application. Check below for common issues.</li>
</ul>
</section>
<section id="keeping-the-app-going" class="level3" data-number="6.2.9">
<h3 data-number="6.2.9" class="anchored" data-anchor-id="keeping-the-app-going"><span class="header-section-number">6.2.9</span> Keeping the App Going</h3>
<ul>
<li>Create a service.</li>
<li>Generally, you might consider putting it here: <code>/etc/systemd/system/</code> on a linux machine.</li>
<li>We’ve named the file <code>blitz.service</code> as an example creating it using <code>nano</code>.</li>
<li>Tutorial for those who do not know how to do this - <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-a-linux-service-to-start-automatically-after-a-crash-or-reboot-part-1-practical-examples">Installation Instructions</a></li>
</ul>
<pre><code># for example 
erin@staple:/var/www/html/STAPLE$ cd /etc/systemd/system/
erin@staple:/etc/systemd/system$ nano blitz.service</code></pre>
<ul>
<li>Example file structure:</li>
<li>Change the <code>WorkingDirectory</code> to your folder.</li>
</ul>
<pre><code>[Unit]
Description=Starts the Blitz service.
After=network.target

[Service]
Type=simple
WorkingDirectory=/var/www/html/STAPLE
ExecStart=/usr/local/bin/blitz start
Restart=always

[Install]
WantedBy=default.target</code></pre>
<ul>
<li>Commands:
<ul>
<li>stop: <code>sudo systemctl stop blitz</code></li>
<li>start: <code>sudo systemctl start blitz</code></li>
<li>restart: <code>sudo systemctl restart blitz</code></li>
<li>reload: <code>sudo systemctl reload blitz</code></li>
<li>disable: <code>sudo systemctl disable blitz</code></li>
<li>re-enable: <code>sudo systemctl enable blitz</code></li>
<li>status: <code>sudo systemctl status blitz</code></li>
<li>reset: <code>sudo systemctl reset-failed blitz</code></li>
</ul></li>
</ul>
<p><em>Many thanks to Scott B. for setting this up and giving instructions</em>.</p>
<ul>
<li>Run <code>sudo systemctl start blitz</code>.</li>
<li>Check the status using <code>sudo systemctl status blitz</code>. Type the letter <code>q</code> to exit.</li>
<li>Status can also help you troubleshoot when you have an error.</li>
</ul>
</section>
<section id="setting-up-the-proxy" class="level3" data-number="6.2.10">
<h3 data-number="6.2.10" class="anchored" data-anchor-id="setting-up-the-proxy"><span class="header-section-number">6.2.10</span> Setting Up the Proxy</h3>
<ul>
<li>Use the following to get to the nginx web server: <code>cd /etc/nginx/sites-enabled</code></li>
<li>Create a file by using <code>nano YOURWEBSITE</code> … for example ours is <code>nano app.staple.science</code> because that is the website of our hosted version of STAPLE.</li>
<li>Create the server file setup:</li>
</ul>
<pre><code># Default server configuration
#
server {
    listen 80;
    server_name app.staple.science;
    error_log /var/www/html/YOURFOLDER/logs/web-server.log;
    location / {
        proxy_pass http://localhost:3000/;
    }
}</code></pre>
<ul>
<li>For <code>https</code> you need to set up a certificate and the easiest solution is through <code>certbot</code>. See <a href="https://certbot.eff.org/">Installation Instructions</a>.</li>
</ul>
<p>sudo apt install python3-certbot-nginx</p>
</section>
</section>
<section id="common-errors" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="common-errors"><span class="header-section-number">6.3</span> Common Errors</h2>
</section>
<section id="run-on-your-own-computer" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="run-on-your-own-computer"><span class="header-section-number">6.4</span> Run on Your Own Computer</h2>
<p>You can also run the software locally on your own computer with a few limitations. If you are using a Linux system, you can follow the instructions above from Blitz/JS Installation through Starting the App - Production. You will be the only user allowed to enter data if you use the software on your own computer, as you are not hosting it on the web for others to connect to. However, you can still use all the functionality of project management and metadata entry/output.</p>
<section id="blitzjs-installation-1" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="blitzjs-installation-1"><span class="header-section-number">6.4.1</span> Blitz/JS Installation</h3>
<ul>
<li>Install <code>node.js</code> and <code>npm</code> for - <a href="https://nodejs.org/en/download">Installation Instructions</a>
<ul>
<li>This installer includes both <code>node.js</code> and <code>npm</code>.</li>
<li>You should have at least node v18+ and npm v9+.</li>
<li>You can check your versions by using <code>node -v</code> and <code>npm -v</code> in a terminal or command window.</li>
<li>You may also use yarn, but this guide uses npm.</li>
</ul></li>
<li>Install <code>blitzjs</code>: <code>npm install -g blitz</code> in a terminal/command window. Check your version is at least v2+ by using <code>blitz -v</code> in a command window.</li>
<li>Depending on your computer setup, you may need <code>sudo</code> privileges.</li>
</ul>
</section>
<section id="clone-this-repository-1" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="clone-this-repository-1"><span class="header-section-number">6.4.2</span> Clone This Repository</h3>
<ul>
<li>Clone or copy this github repository to your computer - <a href="https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository">Installation Instructions</a>. <code>git clone https://github.com/STAPLE-verse/STAPLE.git</code></li>
<li>This will make a folder called STAPLE with all the files you need.</li>
<li>Navigate to that folder in your terminal window.</li>
</ul>
</section>
<section id="database-installation-1" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="database-installation-1"><span class="header-section-number">6.4.3</span> Database Installation</h3>
<ul>
<li>Ensure that you have a local postgres service running on your computer.</li>
<li>To install see: <a href="https://www.prisma.io/dataguide/postgresql/setting-up-a-local-postgresql-database">Installation Instructions</a>.
<ul>
<li>Be sure to write down the superuser information as you are installing the setup for non-Linux machines.</li>
<li>You may use other databases, but will need to modify the provided code for their implementation.</li>
</ul></li>
<li>Create the databases for STAPLE. Go to terminal and use:
<ul>
<li>Note that all lines that start with # are comments for explanation.</li>
</ul></li>
</ul>
<pre><code># get into postgres on mac
psql -U postgres
# enter your password for superuser when prompted
CREATE DATABASE staple;
CREATE DATABASE staple_test;</code></pre>
<ul>
<li>Create a user with appropriate privileges after postgres installation. While in the terminal and postgres, create a new user:</li>
<li>Change out <code>username</code> and <code>password</code> (be sure to leave the quotes!) for your desired user.</li>
</ul>
<pre><code>CREATE USER username WITH PASSWORD 'password';</code></pre>
<ul>
<li>Get into the STAPLE database. You can use <code>\l</code> and should see something like this:</li>
</ul>
<pre><code>postgres=# \l
                                     List of databases
    Name     |  Owner   | Encoding |   Collate   |    Ctype    |     Access privileges     
-------------+----------+----------+-------------+-------------+---------------------------
 postgres    | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 staple      | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =Tc/postgres             +
             |          |          |             |             | postgres=CTc/postgres    +
             |          |          |             |             | staple=CTc/postgres      +
             |          |          |             |             | staple_admin=CTc/postgres
 staple_test | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | 
 template0   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres              +
             |          |          |             |             | postgres=CTc/postgres
 template1   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 | =c/postgres              +
             |          |          |             |             | postgres=CTc/postgres
(5 rows)</code></pre>
<ul>
<li>Use the following to get into the STAPLE database.</li>
</ul>
<pre><code>postgres=# \c staple
You are now connected to database "staple" as user "postgres".
staple=# </code></pre>
<ul>
<li>You can check that schema exist using <code>\dn</code>:</li>
</ul>
<pre><code>staple=# \dn
 List of schemas
  Name  | Owner  
--------+--------
 public | staple
(1 row)

staple=# </code></pre>
<ul>
<li>Give your user the appropriate permissions to write to the database. Change out <code>username</code> for the user you created a minute ago.</li>
</ul>
<pre><code>GRANT ALL ON SCHEMA public TO username;</code></pre>
<ul>
<li>Use <code>quit;</code> to exit out of postgres.</li>
</ul>
</section>
<section id="connect-database-to-staple-app-1" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4" class="anchored" data-anchor-id="connect-database-to-staple-app-1"><span class="header-section-number">6.4.4</span> Connect Database to STAPLE App</h3>
<ul>
<li>Make sure you are in the folder that you copied the github repository into.</li>
<li>You can use <code>ls -al</code> to view all files in that folder.</li>
</ul>
<pre><code># for example on my server 
erin@staple:~$ cd /var/www/html/STAPLE
erin@staple:/var/www/html/STAPLE$ ls -al
total 764
drwxr-xr-x  13 root root   4096 Oct 24 06:17 .
drwxr-xr-x   6 root root   4096 Oct 24 05:02 ..
drwxr-xr-x   3 root root   4096 Oct 24 04:27 db
-rw-r--r--   1 root root    175 Oct 24 04:27 .editorconfig
-rw-r--r--   1 root root    494 Oct 24 06:17 .env
# more truncated # </code></pre>
<ul>
<li>Copy the <code>.env</code> file and rename it <code>.env.local</code>.
<ul>
<li>You may need to turn on settings to see these hidden files on your machine.</li>
<li>You can create and edit this file at once with <code>nano .env.local</code> or <code>vim</code> if you want.</li>
</ul></li>
<li>Ensure the <code>.env.local</code> file has required environment variables.
<ul>
<li>After the commented lines, add the <code>DATABASE_URL</code> line and change <your_db_username> to <code>username:password</code> (no &lt;&gt; these are here to show you what to change).</your_db_username></li>
<li>Create and add a <code>SESSION_SECRET_KEY</code>.
<ul>
<li>In the command line prompt, use <code>openssl rand -hex 16</code> and copy this long letter/number combination instead of <sessionkey>.</sessionkey></li>
</ul></li>
</ul></li>
</ul>
<pre><code># This env file should be checked into source control
# This is the place for default values for all environments
# Values in `.env.local` and `.env.production` will override these values
DATABASE_URL=postgresql://&lt;YOUR_DB_USERNAME&gt;@localhost:5432/staple
SESSION_SECRET_KEY=&lt;SESSIONKEY&gt;</code></pre>
<ul>
<li>Copy the <code>.env.test</code> file and rename <code>.env.test.local</code>.</li>
<li>Ensure the <code>.env.test.local</code> file has required environment variables in the same way you did above.</li>
</ul>
<pre><code>DATABASE_URL=postgresql://&lt;YOUR_DB_USERNAME&gt;@localhost:5432/staple_test</code></pre>
</section>
<section id="install-staple-requirements-1" class="level3" data-number="6.4.5">
<h3 data-number="6.4.5" class="anchored" data-anchor-id="install-staple-requirements-1"><span class="header-section-number">6.4.5</span> Install STAPLE Requirements</h3>
<ul>
<li>Make sure you are in the STAPLE main folder. Use the following (not the <code>#</code> line, these are notes) to install packages, tailwind, and daisyui.</li>
</ul>
<pre><code># to install all packages for staple
npm install
# install tailwind css
blitz install tailwind
# install daisyui
npm i -D daisyui@latest</code></pre>
<ul>
<li>Next, use the following line to create the database structure/schema for STAPLE to run.</li>
</ul>
<pre><code># to create database with the right set up
blitz prisma migrate dev</code></pre>
</section>
<section id="starting-the-app---local-testing-1" class="level3" data-number="6.4.6">
<h3 data-number="6.4.6" class="anchored" data-anchor-id="starting-the-app---local-testing-1"><span class="header-section-number">6.4.6</span> Starting the App - Local Testing</h3>
<ul>
<li>In a terminal window, go to the folder you cloned this repository and type:</li>
</ul>
<pre><code>blitz dev</code></pre>
<ul>
<li>Open (usually) <a href="http://localhost:3000" class="uri">http://localhost:3000</a> (or whatever it says for localhost in the terminal) with your browser to see the result.</li>
<li>Everything you do will be saved this way, so closing the app would mean just closing the app.</li>
</ul>
</section>
<section id="starting-the-app---production-1" class="level3" data-number="6.4.7">
<h3 data-number="6.4.7" class="anchored" data-anchor-id="starting-the-app---production-1"><span class="header-section-number">6.4.7</span> Starting the App - Production</h3>
<ul>
<li>In a terminal window, go to the folder you cloned this repository and type:</li>
</ul>
<pre><code>blitz build</code></pre>
<ul>
<li>This step may produce errors in the build. You will need to fix these errors before running the application. Check below for common issues.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./walkthrough.html" class="pagination-link" aria-label="Example Walkthroughs">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Example Walkthroughs</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./summary.html" class="pagination-link" aria-label="Summary">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>